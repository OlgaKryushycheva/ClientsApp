@model ClientsApp.Models.ViewModels.ClientTaskIndexViewModel

@{
    ViewData["Title"] = "Завдання";
}

<h2>Завдання</h2>

<p>На цій сторінці Завдання Ви можете отримати усю інформацію по усіх завданнях фірми,  а також додавати інформацію, редагувати та видаляти її. </p>
<p>Ви можете здійснювати фільтрацію у зручному для Вас форматі відповідно до обраних фільтрів. </p>

 <a asp-action="Create" class="btn btn-success">Додати завдання</a>

<form asp-action="Index" method="get" class="form-inline mb-3">
    <div class="form-group mr-2">
        <label asp-for="SelectedClientId" class="mr-1">Клієнт:</label>
        <select asp-for="SelectedClientId" class="form-control" asp-items="Model.Clients">
            <option value="">Всі</option>
        </select>
    </div>

    <div class="form-group mr-2">
        <label asp-for="SelectedExecutorId" class="mr-1">Виконавець:</label>
        <select asp-for="SelectedExecutorId" class="form-control" asp-items="Model.Executors">
            <option value="">Всі</option>
        </select>
    </div>

    <div class="form-group mr-2">
        <label asp-for="SelectedStatus" class="mr-1">Статус:</label>
        <select asp-for="SelectedStatus" class="form-control" asp-items="Model.Statuses">
            <option value="">Всі</option>
        </select>
    </div>

    <button type="submit" class="btn btn-primary">Фільтрувати</button>
    <a asp-action="Index" class="btn btn-secondary ms-2" id="resetFilters">Скинути усі фільтри</a>
</form>

<table class="table table-striped">
    <thead>
        <tr>
            <th>Id</th>
            <th>Клієнт</th>
            <th>Опис</th>
            <th>Початок</th>
            <th>Закінчення</th>
            <th>Виконавці</th>
            <th>Статус</th>
             <th>Дії</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var task in Model.Tasks)
        {
            <tr>
                <td>@task.ClientTaskId</td>
                <td>@task.Client?.Name</td>
                <td>@task.Description</td>
                <td>@task.StartDate.ToShortDateString()</td>
                <td>@(task.EndDate?.ToShortDateString() ?? "")</td>
                <td>
                    @if (task.ExecutorTasks != null && task.ExecutorTasks.Any())
                    {
                        foreach (var et in task.ExecutorTasks)
                        {
                            @et.Executor?.FullName <br />
                        }
                    }
                    else
                    {
                        <text>-</text>
                    }
                </td>
                <td>@task.TaskStatus</td>

               <td>
    <a asp-action="Edit" asp-route-id="@task.ClientTaskId" class="btn btn-primary btn-sm">Редагувати</a>
    <a asp-action="Delete" asp-route-id="@task.ClientTaskId" class="btn btn-danger btn-sm">Видалити</a>
</td>

            </tr>
        }
    </tbody>
</table>

@section Scripts {
    <script>
        const nav = window.performance && window.performance.getEntriesByType('navigation')[0];
        if (nav && nav.type === 'reload' && window.location.search) {
            window.location.replace(window.location.pathname);
        }
    </script>
}
